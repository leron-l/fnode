name: Extract Nodes Daily  from free-nodes/v2rayfree.

on:
  schedule:
    # 每天北京时间 19:30 执行 (对应 UTC 11:30)
    - cron: '30 11 * * *'
  workflow_dispatch: # 保持手动触发功能

jobs:
  extract-and-save:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Fetch Markdown and Extract Code
        run: |
          # 使用 raw.githubusercontent.com 获取纯文本 Markdown
          curl -s https://raw.githubusercontent.com/free-nodes/v2rayfree/main/README.md | \
          perl -0777 -ne 'while(/```(?:.*?)\n(.*?)\n```/sg){ print "$1\n"; }' | \
          grep -v '^$' > nodes.txt
          
          echo "提取任务完成时间: $(date)"

      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v7.1.0
        with:
          commit_message: "Daily update: extracted nodes [skip ci]"
          file_pattern: 'nodes.txt'
